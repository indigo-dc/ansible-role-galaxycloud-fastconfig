---
# Install rsync
- name: '[EL] Install rsync'
  yum:
    name: '{{ item }}'
    state: present
  with_items:
    - rsync
  when: ansible_os_family == "RedHat"

- name: '[Ubuntu] Install rsync'
  apt:
    name: '{{ item }}'
    state: present
  with_items:
    - rsync
  when: ansible_os_family == "Debian"

# move datasets to a destination directory
- name: Create destination directory
  file:
    path: '{{ item }}'
    state: directory
    owner: '{{ galaxy_user }}'
    group: '{{ galaxy_user }}'
  with_items:
    - '{{ galaxy_db_dir }}'

- name: Check if src dir exists
  stat:
    path: '{{galaxy_install_path}}/database'
  register: register_galaxy_db_dir

- name: 'Move Galaxy database dir to external volume'
  synchronize:
    src: '{{galaxy_install_path}}/database/'
    dest: '{{dataset_db_dir}}'
  when: register_galaxy_db_dir.stat.exists

- name: Remove unuseful datasets
  file:
    dest: '{{galaxy_install_path}}/database/'
    state: absent
  when: register_galaxy_db_dir.stat.exists
