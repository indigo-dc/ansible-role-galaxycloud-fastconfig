---
- name: Create galaxy config file for lite start
  copy:
    src: '{{ galaxy_config_path }}/galaxy.ini.sample'
    dest: '{{ galaxy_config_path }}/galaxy.lite.{{galaxy_config_file_extension}}'
    remote_src: true

- name: '[release_17.**] Edit galaxy.lite.ini'
  ini_file:
    dest: '{{ galaxy_config_path}}/galaxy.lite.ini'
    section: '{{ item.section }}'
    option: '{{ item.option }}'
    value: '{{ item.value }}'
  with_items:
    - { section: 'app:main', option: 'database_connection', value: '{{ galaxy_database_connection }}' }
    - { section: 'app:main', option: 'install_database_connection', value: '{{ galaxy_install_database_connection }}' }
    - { section: 'app:main', option: 'admin_users', value: '{{ GALAXY_ADMIN_EMAIL }}' }
  when: galaxy_config_file_extension == 'ini'

- name: Edit galaxy.lite.yml
  command: '{{ galaxy_venv_path }}/bin/python
            {{Â galaxy_custom_script_path }}/parse_galaxy_yaml.py
            -c "{{ galaxy_config_path }}/galaxy.lite.yml"
            -s "{{ item.section }}"
            -o "{{ item.option }}"
            -v "{{ item.value }}"'
  with_items:
    - { section: 'galaxy', option: 'database_connection', value: '{{galaxy_database_connection.stdout}}' }
    - { section: 'galaxy', option: 'install_database_connection', value: '{{galaxy_install_database_connection.stdout}}' }
    - { section: 'galaxy', option: 'admin_users', value: '{{galaxy_admin_users.stdout}}' }
  when: galaxy_config_file_extension == 'yml'
