---
- name: Edit galaxy.ini for nginx
  ini_file:
    dest: '{{ galaxy_config_file }}'
    section: '{{ item.section }}'
    option: '{{ item.option }}'
    value: '{{ item.value }}'
  with_items:
    - { section: 'app:main', option: 'nginx_upload_store', value: "{{ nginx_upload_store_path }}" }

- name: Change nginx_upload_store path directory
  lineinfile:
    dest: '/etc/nginx/nginx.conf'
    regexp: '            upload_store /home/galaxy/galaxy/database/tmp/nginx_upload_store;'
    line: '            upload_store {{galaxy_db_dir}}/tmp/nginx_upload_store;'
  become_user: root
  become_method: sudo

- name: Create NGINX upload_store dir
  file:
    path: '{{ nginx_upload_store_path }}'
    state: directory
